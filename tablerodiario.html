<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tablero Diario</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; text-align: center; }
.logo { max-width: 250px; margin-bottom: 10px; }
h1 { margin-bottom: 10px; color: #333; }
#fecha-hora { font-size: 18px; font-weight: bold; color: #444; margin-bottom: 20px; }
table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: center; }
th { background: #048c7c; color: white; font-weight: bold; }
tr:nth-child(even) { background: #f9f9f9; }
tr:hover { background: #e3f2fd; }
</style>
</head>
<body>

<img src="Logo.png" alt="Logo de la empresa" class="logo">
<h1>ASAKAI - TABLERO DIARIO</h1>
<div id="fecha-hora"></div>

<table id="tabla-datos">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
const endpoint = "https://script.google.com/macros/s/AKfycbyTM54acGdDlCC7tnze729wtPBlpxxPtpcN5-pT3IzpyBDgM1_Gjtt608jCJYOyLUM4/exec";

// üîπ Reloj en tiempo real
function actualizarReloj() {
  const ahora = new Date();
  const opciones = { weekday: "long", year: "numeric", month: "long", 
                     day: "numeric", hour: "2-digit", minute: "2-digit", second: "2-digit" };
  document.getElementById("fecha-hora").textContent = ahora.toLocaleDateString("es-ES", opciones);
}
setInterval(actualizarReloj, 1000);
actualizarReloj();

// üîπ Funci√≥n para decidir color seg√∫n fila y objetivo
function colorSegunObjetivo(nombreFila, objetivo, valor) {
  if (!nombreFila || valor === undefined || valor === null) return "";
  const nombreStr = String(nombreFila).trim().toUpperCase();

  const valorNum = Number(String(valor).replace("%","").trim().replace(",",".")); 
  const objNum = Number(String(objetivo).replace(/[^0-9.]/g,"").trim().replace(",","."));

  if (isNaN(valorNum)) return "";

  if (["ACCIDENTES","RECLAMOS CLIENTE (RED)"].includes(nombreStr)) {
    return valorNum === 0 ? "#b6fcb6" : "#fcb6b6";
  }

  if (nombreStr === "BUENO DIRECTO") {
    if (isNaN(objNum)) return "";
    return valorNum > objNum ? "#b6fcb6" : "#fcb6b6";
  }

  if (["PARADAS DE L√çNEA","PARADAS DE L√çNEA POR MP"].includes(nombreStr)) {
    return valorNum < 150 ? "#b6fcb6" : "#fcb6b6";
  }

  if (nombreStr === "PARADAS DE L√çNEA POR LOG√çSTICA") {
    if (isNaN(valorNum) || isNaN(objNum)) return "";
    return valorNum > objNum ? "#fcb6b6" : "#b6fcb6";
  }

  if (["UNIDADES RETENIDAS PISO","UNIDADES RETENIDAS MASIVA","REPARADAS/RETENIDAS"].includes(nombreStr)) {
    if (isNaN(valorNum) || isNaN(objNum)) return "";
    return valorNum > objNum ? "#fcb6b6" : "#b6fcb6";
  }

  if (["CUMPLIMIENTO PLAN DESPACHO","RELACI√ìN DESPACHADO VS PRODUCIDO"].includes(nombreStr)) {
    if (isNaN(valorNum) || isNaN(objNum)) return "";
    return valorNum >= objNum ? "#b6fcb6" : "#fcb6b6"; 
  }

  // üîπ NUEVO: AUSENTISMO REAL, AUSENTISMO GESTIONABLE y Te/Tr
  if (["AUSENTISMO REAL", "AUSENTISMO GESTIONABLE", "TE/TR"].includes(nombreStr)) {
    if (isNaN(valorNum) || isNaN(objNum)) return "";
    return valorNum <= objNum ? "#b6fcb6" : "#fcb6b6"; 
  }

  if (!isNaN(objNum)) {
    return valorNum >= objNum ? "#b6fcb6" : "#fcb6b6";
  }

  return "";
}

// üîπ Cargar datos del Google Sheet
async function cargarDatos() {
  try {
    const res = await fetch(endpoint);
    const data = await res.json();
    if (!data || data.length === 0) return;

    const tabla = document.getElementById("tabla-datos");
    const thead = tabla.querySelector("thead");
    const tbody = tabla.querySelector("tbody");

    const columnas = Object.keys(data[0]);
    thead.innerHTML = "<tr>" + columnas.map(h => `<th>${h}</th>`).join("") + "</tr>";

    const colNombreFila = "INDICADORES";  
    const colObjetivo = "OBJ";             
    const columnasDias = ["LUN","MAR","MIE","JUE","VIE"];  

    tbody.innerHTML = data.map(r => {
      let fila = "<tr>";
      const nombreFila = r[colNombreFila];
      const objetivo = r[colObjetivo];

      columnas.forEach(col => {
        let valor = r[col];
        let color = "";

        if (columnasDias.includes(col)) {
          color = colorSegunObjetivo(nombreFila, objetivo, valor);
        }

        fila += `<td style="background-color:${color}">${valor}</td>`;
      });

      fila += "</tr>";
      return fila;
    }).join("");

  } catch (err) {
    console.error("Error cargando datos:", err);
  }
}

// Cargar al inicio
cargarDatos();

// Refrescar cada 10 minutos
setInterval(cargarDatos, 600000);
</script>

</body>
</html>
